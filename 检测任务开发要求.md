# 检测任务开发要求

## 0、关于指令的分类、如何设计一个难指令

### 0.1 任务完成 vs 信息检索
目前大家还是比较缺少“信息检索类”，我觉得这类比较好设计，检测脚本也比较好写。

#### （1）信息检索类指令——找东西
信息检索类任务的特点是：目标是获取一段信息

例子：
- “帮我看看会议室明天上午有没有空。”
- “告诉我微信里张三最新一条消息是什么。”
- “在淘宝上看看iPhone 15的价格。”

本质：让Agent找到正确的页面 → 读取信息 → 返回

对Agent的考验点：
- 路径识别（点哪个tab）
- 文本定位（哪个列表项）
- 信息读取（提取价格、时间、标题等）

#### （2）任务完成类指令——做事情
任务完成类任务的特点是：
- 不只是找信息，还要完成一个动作
- 涉及表单填写、路径规划、多步骤组合
- 有明确的“成功条件”

例子：
- “帮我订一个明天早上10点从北京到上海的机票，经济舱。”
- “给李四转88元，备注生日快乐。”
- “在算法课讨论群里发一条消息，告诉大家明天九点开会。”

本质：让Agent找到正确入口 → 填数据 → 进行确认 → 检查成功状态

对Agent的考验点：
- 状态迁移（页面跳转多）
- 精确输入（表单名称、金额、备注）
- 成功检测（是否完成支付？是否发送成功？）


### 0.2 我们已经发现的、对于AI而言比较难的指令类型
不仅仅是“步骤多”才叫难。
在实际测试中，我们发现某些指令，即使步骤不多，AI也会异常容易出错。

#### （1）需要推理的任务：不止是操作，还要“理解”
这类指令的核心不是点到哪里，而是让AI对页面内容进行逻辑处理。
通常包括：
- 计数
- 统计
- 比较
- 归类
- 排序
- 聚合
- 条件过滤
- 跨页面决策的任务

这些都超出了“找到一个按钮”这种简单范畴。

例子：
- 帮我看看我的购物车里面，手机类产品一共多少钱啊？
  1. AI必须理解哪些是“手机类”。手机壳算吗？平板算吗？配件算吗？这是分类任务。
  2. AI必须提取价格，并进行求和。可能有促销、满减价格。这是信息抽取 + 数学推理。
  3. 页面可能很长，需要滑动、多屏整合信息。这对UI定位非常容易出错。
- 看下饿了么推荐的前十家好评最多的店铺，告诉我哪一家月销量最好？
  AI需要先找到“好评最多的前十家”（需要排序 + 选择前十）
  再从这十条里面比较“月销量”（月销量字段不一定在显眼位置）
  两个维度的排序混合：A维度选前十，再根据B维度找最大
- 看下张老师发给我的会议参会人员名单文件，然后依次通知他们明天按时来开会。
  它不是一个动作，而是：
  1. 找到文件
  2. 打开文件
  3. 读取名单
  4. 回到聊天界面
  5. 找到每一个人
  6. 发送通知
  7. 完成后继续下一个人
  每一步都依赖上一步成功。
  任何一个阶段出错，后面所有步骤都无法继续。

#### （2）“藏得很深”的任务
有一些任务不是因为逻辑复杂，而是因为**入口极其隐蔽**。
对普通人都不容易找到，对AI来说更是高难度。

这类任务的共同特点：
- 入口在三级、四级甚至五级菜单之后
- 中间路径没有明显提示
- 按钮名称含糊，不容易推理
- 不同版本的App路径还可能不一样

AI必须精准地找到路径，否则任务连第一步都无法展开。

如果一个任务藏在比较深的位置，对人类而言都很难，例如：
- 微信绑定邮箱：test@example.com
- 饿了么开启免密支付


## 1、关于大家设计的指令

### 1.1 被采纳的指令、未被采纳的指令、我新增的指令
在路径`\AppSim\src\appsim\tasks\APP_NAME\__init__.py`下，你可以看到实际使用的指令是哪些


### 1.2 普遍存在的一些共性问题

#### 1.2.1 描述不清楚
一个指令，就是一个任务，想象你有一个秘书，你要对它发号施令。
你的命令一定要是准确的，不能含糊不清的，类似于下图的几个指令就有些不合适，例如：
- “王xx”是谁？
- “自身麦克风静音”指的是关闭哪一个会议的麦克风呢？还是在系统设置里面关闭麦克风？


#### 1.2.2 描述太清楚了
既然是秘书帮你干活，那么我们还是希望省心点，秘书要发挥自己的能动性，而不是我告诉你：“第一步应该xxx，第二步应该xxx”，类似于：
- 下面这个“免密支付”，我应该直接给他说，“开启我的免密支付”，而不是如此清楚的给他写明步骤

为什么不能太清楚了？
对于AI而言，一项长步骤的任务必然是很难的，难就难在他需要自主规划“应该分几步”、“每一步应该干什么”。
如果你把步骤写得太清楚，那你这个任务就失去价值了，对他而言，就是照着答案直接抄，因为你已经把每一个应该干什么都告诉他了。


#### 1.2.3 缺少停止信号
如果没有明确停止信号，AI无法判断“任务什么时候结束”，也不知道“成功条件是什么”。
这会导致：不必要的多余操作

例如饿了么有一个指令叫：进入“我的”→“我的账单”页面，切换到“月账单”，看看本月花了多少钱。
其检验逻辑是：判断AI有没有进入到“月账单”页面。

指令倒是写的很好，可是检测逻辑和指令并不对应。
这显然是不合理的，如果你希望AI进入到这个页面就停止（然后人类自己看页面内容），那你应该写：
`进入月账单，然后停留在这个页面。【任务完成类】`

如果你希望让AI帮你查询，那你应该写：
`进入月账单，然后告诉我这个月我花了多少钱？【信息检索类】`


## 2、关于检测脚本（eval_xxx.py）

### 2.1 请保证你的检测函数一定要包含2个参数，result和device_id，默认设置为None

#### （1）什么是result：
它是AI执行任务过程形成的一段总结性描述，记录了每一步执行了什么、共执行多少步、每一步的截图是什么、任务完成的时候形成的final_message是什么。

下面展示result的一个例子，任务是：“数一下，小明的朋友圈，有多少人为他点赞”，你会发现他一共执行了4步，其final_message是15。
```json
{
  "success": true,
  "completed_steps": 4,
  "total_actions": 4,
  "executed_actions": [
    {
      "action": "click",
      "point": "point:623 936/point"
    },
    {
      "action": "click",
      "point": "point:500 150/point"
    },
    {
      "action": "scroll",
      "point": "point:500 855/point",
      "direction": "down"
    },
    {
      "action": "finished",
      "content": "15"
    }
  ],
  "screenshots": [
    "results/UI-TARS-1.5/screenshots\\com.example.fakewechat\\2825111",
    "results/UI-TARS-1.5/screenshots\\com.example.fakewechat\\2825111",
    "results/UI-TARS-1.5/screenshots\\com.example.fakewechat\\2825111",
    "results/UI-TARS-1.5/screenshots\\com.example.fakewechat\\2825111"
  ],
  "final_message": "15"
}
```

#### （2）什么是device_id：
指定连接哪台安卓设备
adb连接的时候可以指定连接哪台设备。

你可以阅读我下面这份代码的逻辑，严格按照这个来写
- 如果提供device_id，我会针对性打开这台设备


### 2.2 信息检索类的检测
这类相当好写，只需要去AI的回复中检查有无我需要的信息，
但是要注意一个问题：有些指令的答案实在太简单（比如“1”“5”），容易误检，比如

- 指令：查看首页的15个聊天记录，计算明天的日程数量。
  - 正确答案：1
  - AI的final_message是“通过对这15个聊天记录的分析，你明天有3个日程”
- 若直接判断 `if "1" in result["final_message"]`，会误检


【3个修复策略】
1. 修改后端数据，避免答案过于简单
2. 在指令中增加约束，例如：
   a. “查看首页的15个聊天记录，计算明天的日程数量。请直接输出明天日程数量的数字，不要加解释。”
3. 调整判断逻辑，例如：
   a. 判断“1个”“1项”“一个”“一项”等是否出现在 `result["final_message"]`


示例代码：
```python
# 5、看看家庭群，确定一下周六几点集合？在哪集合？告诉我答案即可。
def Task5_info_search(result=None, device_id=None):
    # 验证result存在
    if result is None:
        return False
    if "final_message" in result and (
        ("9点" in result["final_message"] or "1点" in result["final_message"])
        and "客厅门口" in result["final_message"]
    ):
        return True
    else:
        return False

if __name__ == "__main__":
    result = Task5_info_search()
    print(result)
```


### 2.3 任务完成类的检测
这类大家都有经验了，我只提醒一点：别忘了adb指定device_id


## 3、下一步的任务
目前大家得到的脚本，里面涉及的指令都是检测没问题的。
请大家先把之前自己设计了但未被采纳的指令进行检查，修复bug后增加到脚本内，近几日我们的工作均为增加指令数量。
**如果是相当简单的指令，则不需要修复了，我们现在更希望要一些难度更大的指令。**


### 对AppSim-main\src\appsim\tasks\base.py的解释
在TaskItem类中，这四个字段用于定义应用自动化测试任务：

1. **instruction**: str - 任务指令描述
   - 含义：用自然语言描述的任务指令，告诉AI代理要做什么
   - 示例："发信息到工作群，说'GUI Agent最近很火，我觉得挺有意思的'"

2. **verify_func**: Callable[[dict], Any] - 验证函数
   - 含义：用于验证任务是否成功完成的函数，接受包含执行结果、设备ID等的字典参数
   - 示例：从eval_2.py看到的Task2_MessageSendCheck函数，通过adb读取消息数据并验证发送成功

3. **human_steps**: int - 人类执行步骤数
   - 含义：人类完成该任务通常需要的操作步骤数，用于评估任务复杂度
   - 示例：发送一条消息可能需要5步（打开微信→找到群聊→输入消息→发送）

4. **is_reasoning**: bool - 是否为推理任务
   - 含义：标识任务是否需要推理能力（如查找信息、分析内容），还是简单操作任务
   - 示例：True表示需要推理（如"查看好友朋友圈，告诉我前五条的内容"）；False表示简单操作（如"发送消息"）
新增的指令应该是包括上述四个字段的,例如
```python
TaskItem(
    instruction="发信息到工作群,说'GUI Agent最近很火,我我觉得挺有意思的""
    verify_func=verify_message_sent,
    human_steps=4, #人类需要:打开微信→找到群→输入消息→发送
    #这是简单操作,不需要复杂推理
    is_reasoning=False
)
```

## 当前已有任务

### 已完成的检测任务列表（按eval脚本顺序排列）

#### 信息检索类
1. 查看历史会议记录 - eval_3
2. 查看最近一场会议的会议主题和会议时长 - eval_13
3. 数一下会议列表中的会议数目（预期结果：50） - reasoning_tasks
4. 数一下我的联系人数目（预期结果：150） - reasoning_tasks
5. 数一下我的会议室的参会人数（技术讨论会议，预期结果：3） - reasoning_tasks
6. 数一下未开始会议的数目（预期结果：16） - reasoning_tasks
7. 数一下周姓的人数（预期结果：8） - reasoning_tasks
8. 计算手机号13开头的人数（预期结果：40） - reasoning_tasks
9. 数一下会议中可邀请的人员数量 - reasoning_tasks

#### 任务完成类
1. 在技术讨论会议（会议号Meeting_3d7e91）中打开自己的麦克风 - eval_1
2. 在技术讨论会议（会议号Meeting_3d7e91）中打开自己的摄像头 - eval_2
3. 在技术讨论会议（会议号Meeting_3d7e91）中关闭所有人的麦克风 - eval_4
4. 在技术讨论会议（会议号Meeting_3d7e91）中发送消息"大家好" - eval_5
5. 保持默认配置创建一场快速会议 - eval_6
6. 预约一场会议，时间定为明天晚上八点，邀请所有好友参加 - eval_7
7. 在历史会议里观看最近一次会议的回放 - eval_8
8. 用会议号341234546 + 密码312435加入会议 - eval_9
9. 在技术方案讨论中，开启共享屏幕 - eval_11
10. 在技术讨论会议中举手发言 - eval_12
11. 呼叫手机号为15823467912的联系人 - eval_17
12. 复制我的邀请链接让别人加我为好友 - eval_20
13. 通过会议号Meeting_5d8e21共享屏幕 - eval_28
14. 将"个人会议室"的"等候室"设置为"开启"，然后进入会议室 - eval_29

## 新增任务

### 信息检索类（难）

1. **多条件过滤与统计**
   - 指令：帮我统计一下，未开始的会议中，有多少个会议设置了密码？
   - 难度：★★★★☆
   - 考验点：条件过滤（未开始会议）+ 信息提取（是否设置密码）+ 统计
   - 预期结果：直接输出未开始且设置了密码的会议数量

2. **跨页面信息整合**
   - 指令：帮我查看一下，陈思远创建的所有会议中，参与人数最多的会议主题是什么？
   - 难度：★★★★☆
   - 考验点：用户识别 + 会议列表筛选 + 参与人数统计 + 比较排序
   - 预期结果：直接输出参与人数最多的会议主题

3. **复杂条件搜索**
   - 指令：帮我找一下，明天下午两点到四点之间开始的会议，并且主持人是周姓用户的会议号是什么？
   - 难度：★★★★☆
   - 考验点：时间范围过滤 + 主持人姓氏筛选 + 会议号提取
   - 预期结果：直接输出符合条件的会议号

4. **会议消息统计**
   - 指令：帮我统计一下，技术讨论会议（meeting_3d7e91）中，陈思远发送了多少条消息？
   - 难度：★★★★★
   - 考验点：会议定位 + 消息查看 + 发送者识别 + 按发送者分组统计
   - 预期结果：输出每个参与者的消息数量，格式如"user002: 15条, user003: 12条, user004: 8条"

5. **会议时长计算**
   - 指令：帮我计算一下，所有已结束会议的平均时长是多少分钟？
   - 难度：★★★★☆
   - 考验点：会议状态筛选 + 时长计算 + 平均值计算
   - 预期结果：直接输出平均时长，如"45分钟"

### 任务完成类（难）

1. **多步骤会议设置**
   - 指令：创建一场明天下午三点的会议，设置会议密码为"123456"，启用等候室，关闭参与者自行解除静音功能，邀请所有周姓好友参加。
   - 难度：★★★★★
   - 考验点：会议预约 + 多参数设置 + 特定人群邀请 + 多步骤组合
   - 成功条件：会议创建成功，所有设置生效，邀请发送成功

2. **参与者管理组合操作**
   - 指令：进入技术讨论会议，将所有参与者静音，然后解除林雨萱的静音，最后将王俊豪移出会议。
   - 难度：★★★★☆
   - 考验点：会议进入 + 批量操作 + 单个操作 + 顺序执行
   - 成功条件：所有参与者静音，林雨萱解除静音，王俊豪被移出

3. **复杂会议邀请**
   - 指令：帮我邀请所有手机号13开头的联系人参加明天上午10点的会议，并设置会议主题为"重要会议"。
   - 难度：★★★★☆
   - 考验点：联系人筛选 + 会议预约 + 批量邀请
   - 成功条件：会议创建成功，所有符合条件的联系人收到邀请

4. **个人会议室高级设置**
   - 指令：进入个人会议室设置，修改会议密码为"888888"，启用等候室，设置静音入会，然后创建一场个人会议室会议。
   - 难度：★★★★☆
   - 考验点：设置路径查找 + 多参数修改 + 会议创建
   - 成功条件：所有设置生效，会议创建成功

5. **会议消息与举手组合操作**
   - 指令：进入技术讨论会议，发送消息"我有问题"，然后举手发言，等待3秒后放下手。
   - 难度：★★★★☆
   - 考验点：会议进入 + 消息发送 + 举手操作 + 放下手操作 + 顺序执行
   - 成功条件：消息发送成功，举手和放下手操作完成

## 新增任务说明

### 数据更新说明
随着数据的扩展，以下任务的预期结果需要更新：
- 会议列表中的会议数目：50（原38）
- 联系人数目：150（原60）
- 未开始会议数目：16（原13）
- 周姓人数：8（原5）
- 手机号13开头人数：40（原24）

这些更新后的预期结果应在相应的检测脚本中进行修改。